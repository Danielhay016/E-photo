<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Admin Dashboard</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.reflowhq.com/v2/toolkit.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&amp;display=swap">
    <link rel="stylesheet" href="assets/css/bs-theme-overrides.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="assets/css/admin.css">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link rel="stylesheet" href="assets/css/cart.css">
    <script src="../views/assets/js/auth.js"></script>
</head>

<body>
    <header>
        <nav class="navbar navbar-light navbar-expand-md sticky-top navbar-shrink py-3" id="mainNav">
            <div class="container"><a class="navbar-brand d-flex align-items-center" href=""><img src="assets/img/logo3.jpg" width="172" height="82"></a><button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-1"><span class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navcol-1" style="padding-bottom: 0px;padding-left: 0px;padding-right: 0px;margin-right: 31px;">
                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="products.html">Products</a></li>
                        <li class="nav-item"><a class="nav-link" href="contacts.html">Contacts</a></li>
                        <li class="nav-item"><a class="nav-link" href="aboutus.html">About us</a></li>
                        <li class="nav-item"><a class="nav-link" href="WebSockt.html">Start Chat!</a></li>
                        <li class="nav-item" id="storeInfoNavItem"><a class="nav-link active" href="admin.html">Store Info</a></li>
                    </ul>
                    <a href="userProfile.html" class="btn btn-primary" style="display: none;"> My Account</a>
                    <a href="#" class="btn btn-primary" id="cartButton" style="display: none; margin-left: 10px;"> Cart <span id="cartQuantity"></span> </a>
                </div>
                <div style="display: flex; justify-content: center; align-items: center;">
                    <a id="authButton" class="btn btn-primary" role="button">
                        <span style="color: #fdfdfd;"></span>
                    </a>
                </div>
            </div>
        </nav>
        
    </header>
    <aside id="shopping-cart" class="shopping-cart">
        <h3>Shopping Cart</h3>
        <ul id="cart-items"></ul>
        <p id="cartTotal"></p>
        <button id="payButton">Pay</button>
    </aside>
    <div class="content">
        <div class="facebook-post-form">
            <!-- Facebook post form section -->
        </div>
    </div>
    <div class="headLine">
        <h2 class="filtered-text">All Registers</h2>
    </div>
    <form class="d-flex" role="search" id="searh_form">
        <div class="container text-center">
            <div class="row g-3 m-1 " id="userTable">
                <!-- User table section -->
            </div>
        </div>
        
          
    
        <script>
            // Fetch user data from MongoDB using an API endpoint
            async function fetchUserData() {
                const response = await fetch('/api/store-user'); // Replace with your API endpoint
                const data = await response.json();
                return data;
            }
        
            // Function to render the user table
            function renderUserTable(data) {
                const tableContainer = d3.select('#userTable');
                const table = tableContainer.append('table').attr('class', 'table');
                
                // Table header
                const thead = table.append('thead').append('tr');
                thead.append('th').text('ID');
                thead.append('th').text('Username');
                thead.append('th').text('Email');
                thead.append('th').text('Actions');
        
                // Table body
                const tbody = table.append('tbody');
                data.forEach(user => {
                    const row = tbody.append('tr');
                    row.append('td').text(user._id); // Assuming the user document has _id field
                    row.append('td').text(user.name);
                    row.append('td').text(user.email);
                    const actionsCell = row.append('td');
                    const deleteButton = actionsCell.append('button').attr('class', 'btn btn-danger').text('Delete');
                    deleteButton.on('click', () => deleteUser(user._id)); // Call a function to delete the user
                });
            }
            


            
        
            // Function to delete a user
            async function deleteUser(userId) {
        const response = await fetch(`/api/store-user`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ _id: userId })
        });

        const data = await response.json();
        if (data.success) {
            // Reload the user table after successful deletion
            const userData = await fetchUserData();
            d3.select('#userTable').selectAll('*').remove(); // Clear existing table
            renderUserTable(userData);
        } else {
            console.error('Failed to delete user.');
        }
    }

        
            // Entry point: Fetch user data and render the user table
            async function init() {
                const userData = await fetchUserData();
                renderUserTable(userData);
            }
        
            init(); // Initialize the script when the page loads
        </script>
    </form>
   
       
<div class="headLine">
    <h2 class="filtered-text" >Product Availability - Scatter Plot</h2>
</div>
<div id="scatter-plot-container" class="text-center">
    <svg id="scatter-plot"></svg>
</div>

<script>
    // Load data from the server (Product availability data)
    d3.json("http://localhost:3330/api/store-products", function (error, data) {
        if (error) throw error;

        const products = data.map(item => ({ name: item.name, countInStock: item.countInStock }));

        // Create scales for X and Y values for the Scatter Plot
        const scatterPlotWidth = 1300;
        const scatterPlotHeight = 1000;

        const xScaleScatterPlot = d3.scaleLinear()
            .domain([0, d3.max(products, product => product.countInStock)])
            .range([0, scatterPlotWidth]);

        const yScaleScatterPlot = d3.scaleLinear()
            .domain([0, d3.max(products, product => product.countInStock)])
            .range([scatterPlotHeight, 0]);

        // Create SVG for the Scatter Plot
        const svgScatterPlot = d3.select("#scatter-plot")
            .attr("width", scatterPlotWidth)
            .attr("height", scatterPlotHeight);

        const chartGroupScatterPlot = svgScatterPlot.append("g")
            .attr("transform", `translate(40, 20)`);

        // Create X and Y axes for the Scatter Plot
        const xAxisScatterPlot = d3.axisBottom(xScaleScatterPlot);
        const yAxisScatterPlot = d3.axisLeft(yScaleScatterPlot);

        chartGroupScatterPlot.append("g")
            .attr("class", "x-axis")
            .attr("transform", `translate(0, ${scatterPlotHeight})`)
            .call(xAxisScatterPlot);

        chartGroupScatterPlot.append("g")
            .attr("class", "y-axis")
            .call(yAxisScatterPlot);

        // Create circles for the Scatter Plot
        chartGroupScatterPlot.selectAll(".circle")
            .data(products)
            .enter().append("circle")
            .attr("class", "circle")
            .attr("cx", product => xScaleScatterPlot(product.countInStock))
            .attr("cy", product => yScaleScatterPlot(product.countInStock))
            .attr("r", 5);

        // Add text labels to the circles
        chartGroupScatterPlot.selectAll(".text-label")
            .data(products)
            .enter().append("text")
            .attr("class", "text-label")
            .attr("x", product => xScaleScatterPlot(product.countInStock) + 7)
            .attr("y", product => yScaleScatterPlot(product.countInStock) - 7)
            .text(product => product.name);

    });
</script>

<div class="headLine">
    <h2 class="filtered-text">Add Product</h2>
</div>
<form id="addProductForm">
    <input type="text" id="name" placeholder="Product Name" required>
    <input type="text" id="image" placeholder="Image URL" required>
    <input type="text" id="brand" placeholder="Brand" required>
    <input type="text" id="category" placeholder="Category" required>
    <input type="number" id="price" placeholder="Price" required>
    <input type="number" id="countInStock" placeholder="Count In Stock" required>
    <input type="number" id="rating" placeholder="Rating" required>
    <input type="number" id="numReviews" placeholder="Number Of Reviews" required>
    <input type="text" id="description" placeholder="Description" required>
    <input type="text" id="color" placeholder="Color" required>
    <input type="text" id="popularity" placeholder="Popularity" required>
    <button type="submit">Add Product</button>
  </form>

    

    <div class="headLine">
        <h2 class="filtered-text">Cost Measures</h2>
    </div>
    <div class="point">
        <p><strong>Point 1:</strong> It's important to meticulously track the overall costs of products, including production,
            shipping, and marketing expenses, to ensure that prices and profits are achieved in a profitable and competitive
            manner.</p>
    </div>

    <div class="point">
        <p><strong>Point 2:</strong> Managers can utilize profit and loss graph analysis to identify areas with potential for
            improvement. Particularly, focusing on products that deliver higher profitability and exploring ways to boost
            sales while reducing variable costs.</p>
    </div>
    
    <div id="chart-container" class="text-center">
        <svg id="chart"></svg>
    </div>
   
    <script>
  // Define the dimensions of the SVG canvas
const width = 1800; // גודל ה-SVG גדל ל-800
const height = 400;

// Create the SVG element
const svg = d3.select("#chart")
    .attr("width", width)
    .attr("height", height);

// Define the margins for the chart
const margin = { top: 20, right: 30, bottom: 50, left: 40 }; // שינוי בהגדרת הרגל תחתון
const innerWidth = width - margin.left - margin.right;
const innerHeight = height - margin.top - margin.bottom;

// Create scales for X and Y values
const xScale = d3.scaleBand()
    .range([0, innerWidth])
    .padding(0.1);

const yScale = d3.scaleLinear()
    .range([innerHeight, 0]);

// Create the chart group
const chartGroup = svg.append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

// Load data from MongoDB
d3.json("http://localhost:3330/api/store-products", function(error, data) {
    if (error) throw error;

    // Create an array of product names and their corresponding prices
    const products = data.map(item => ({ name: item.name, price: item.price }));

    // Set domains for X and Y scales
    xScale.domain(products.map(product => product.name));
    yScale.domain([0, d3.max(products, product => product.price)]);

    // Create X and Y axes
    const xAxis = d3.axisBottom(xScale);
    const yAxis = d3.axisLeft(yScale);

    chartGroup.append("g")
        .attr("class", "x-axis")
        .attr("transform", `translate(0,${innerHeight})`)
        .call(xAxis);

    chartGroup.append("g")
        .attr("class", "y-axis")
        .call(yAxis);

    // Create bars for the products
    chartGroup.selectAll(".bar")
        .data(products)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("x", product => xScale(product.name))
        .attr("y", product => yScale(product.price))
        .attr("width", xScale.bandwidth())
        .attr("height", product => innerHeight - yScale(product.price));
});

    </script>
    
    </form>
    <div class="container text-center">
        <div class="row g-3 m-1 " id="cards">
            <!-- Branch cards section -->
        </div>
    </div>
    <!-- Modal for branch deletion -->
    <div class="modal fade" id="staticXbuttonOnBranches" tabindex="-1" aria-labelledby="staticBackdropLabel"
        aria-hidden="true">
        <!-- Branch deletion modal content -->
    </div>

    <!-- Data visualization section -->
    <div style="display: flex; flex-wrap: wrap; margin-top: 50px; justify-content: space-between;">
        <div id="my_dataviz1"></div>
        <div id="my_dataviz2"></div>
        <div id="my_dataviz3"></div>
    </div>

    <footer>
        <!-- Your footer content here -->
    </footer>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="assets/js/admin.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="assets/js/cart.js"></script>
</body>

</html>